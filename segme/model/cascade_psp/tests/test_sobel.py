import tensorflow as tf
from tensorflow.python.keras import keras_parameterized, testing_utils
from ..sobel import Sobel


@keras_parameterized.run_all_keras_modes
class TestDenseBlock(keras_parameterized.TestCase):
    def test_layer(self):
        testing_utils.layer_test(
            Sobel,
            kwargs={'epsilon': 1e-4},
            input_shape=[2, 62, 62, 1],
            input_dtype='float32',
            expected_output_shape=[None, 62, 62, 1],
            expected_output_dtype='float32'
        )
        testing_utils.layer_test(
            Sobel,
            kwargs={'epsilon': 1e-4},
            input_shape=[2, 63, 63, 5],
            input_dtype='float32',
            expected_output_shape=[None, 63, 63, 5],
            expected_output_dtype='float32'
        )

    def test_values_1(self):
        source = [
            [[[0.4631650319721009], [0.6899293128999265], [0.29820017625336837], [0.7329626123379116],
              [0.25686732539568213], [0.5710680268077866], [0.02588852016923704], [0.9733497898843338]],
             [[0.8067875103350478], [0.21041612151618705], [0.13924756050071907], [0.4817871894195934],
              [0.9985152600269085], [0.9039840334923755], [0.08750446392266864], [0.28773501208339614]],
             [[0.5649121331150919], [0.6335857721024288], [0.8060668780590354], [0.8779242704971314],
              [0.7268878460578188], [0.5057324939280576], [0.6419083761347706], [0.8622895430985613]],
             [[0.5815669394834715], [0.05766340531031122], [0.46513449122927053], [0.14149921934791787],
              [0.8665397870754796], [0.9828931673876301], [0.8617730247637924], [0.7181205238916836]],
             [[0.29008089399994963], [0.10266312786542686], [0.753969938796454], [0.6772942439603874],
              [0.6375986457791315], [0.9783075672691657], [0.301949848766206], [0.11804176265163635]],
             [[0.7605137412124817], [0.9278562464041644], [0.5894840473612148], [0.8715651080343951],
              [0.2317983588147542], [0.1730747019278278], [0.7959702908377568], [0.8580792598625707]],
             [[0.5226163991969551], [0.6119669420248791], [0.6288943751734657], [0.5558523569697312],
              [0.3718350776205853], [0.8204759254697526], [0.4715351799688161], [0.5279031451958889]],
             [[0.09924491025815418], [0.020578464655668594], [0.11225350831922942], [0.72780542920303],
              [0.9468128333003387], [0.8193111481174808], [0.18187643578277657], [0.37629392529519223]]],
            [[[0.8749831697925537], [0.09175840660723789], [0.5500258435811148], [0.0009514600458462308],
              [0.4380578728106981], [0.6442075112540894], [0.9290877936820139], [0.9983587553481084]],
             [[0.674139686601731], [0.8500207954287755], [0.430415973340586], [0.9972940642791145],
              [0.6435614787179128], [0.3429364445763833], [0.981994485090828], [0.14885942481384895]],
             [[0.7205512714329135], [0.10586325085379755], [0.20353548016374723], [0.7468159361433918],
              [0.6263981641423868], [0.9644148102750038], [0.8536654725203892], [0.8390867698404776]],
             [[0.018124802242601823], [0.7421680240042269], [0.6095746997869989], [0.2897830115211455],
              [0.7738270563334082], [0.9622283293457748], [0.09810578035037965], [0.08815044560302643]],
             [[0.9011215157305897], [0.45647547800782307], [0.7644479795098218], [0.41660536022413086],
              [0.14614516910827025], [0.9640521485660999], [0.26216552082242317], [0.8357336381424243]],
             [[0.5805069364187141], [0.24168984906478053], [0.019671833320062726], [0.7857766256122469],
              [0.967896188676584], [0.33824210977734204], [0.977355812511194], [0.15221559949412355]],
             [[0.35055805741218804], [0.1173177469468234], [0.8791773675988133], [0.5166550933081105],
              [0.9736599470588517], [0.5745835971833763], [0.3203181256815195], [0.2567640519987724]],
             [[0.9107192085175753], [0.42320578884723936], [0.4371414667070137], [0.8427373467916232],
              [0.2715232522324591], [0.11442471231265161], [0.6091248952689764], [0.14068653789814478]]]
        ]
        expected = [
            [[[0.535335123538971], [0.5357765555381775], [0.5483253598213196], [0.6172982454299927],
              [0.6157035827636719], [0.5789710283279419], [0.5266323685646057], [0.5285327434539795]],
             [[0.48405495285987854], [0.053492408245801926], [0.0957731083035469], [0.2134595364332199],
              [0.12799279391765594], [0.22857369482517242], [0.23007424175739288], [0.5741730332374573]],
             [[0.49462398886680603], [0.07774489372968674], [0.136446014046669], [0.2363860011100769],
              [0.10435362905263901], [0.16120173037052155], [0.18456004559993744], [0.6315115690231323]],
             [[0.48083093762397766], [0.07344606518745422], [0.15468662977218628], [0.20678652822971344],
              [0.11111835390329361], [0.07784811407327652], [0.11904407292604446], [0.6552962064743042]],
             [[0.5252529382705688], [0.15285715460777283], [0.11766086518764496], [0.10076288133859634],
              [0.13004156947135925], [0.15171796083450317], [0.13149429857730865], [0.6306719779968262]],
             [[0.5329508781433105], [0.0823928713798523], [0.05073259398341179], [0.020458713173866272],
              [0.042213138192892075], [0.08265615999698639], [0.09168966859579086], [0.5836323499679565]],
             [[0.4956326186656952], [0.24403034150600433], [0.1949121505022049], [0.08928298205137253],
              [0.06992242485284805], [0.09779641777276993], [0.06441561132669449], [0.5568140149116516]],
             [[0.46235963702201843], [0.5070093870162964], [0.5553327202796936], [0.5914434790611267],
              [0.5804791450500488], [0.5693145394325256], [0.5569462776184082], [0.5751265287399292]]],
            [[[0.5770111680030823], [0.507962703704834], [0.4758524000644684], [0.5208926796913147],
              [0.6205833554267883], [0.7031932473182678], [0.7521256804466248], [0.7828109264373779]],
             [[0.5213049650192261], [0.0994342640042305], [0.03574739024043083], [0.16285663843154907],
              [0.20594127476215363], [0.09375858306884766], [0.1036120355129242], [0.7045482397079468]],
             [[0.493599534034729], [0.01686703972518444], [0.06275077909231186], [0.16064946353435516],
              [0.13135375082492828], [0.05869365856051445], [0.17953409254550934], [0.66492760181427]],
             [[0.49287664890289307], [0.02818789891898632], [0.06756443530321121], [0.1751517653465271],
              [0.12980712950229645], [0.09779812395572662], [0.18415333330631256], [0.606307864189148]],
             [[0.4871853291988373], [0.029639391228556633], [0.06009986624121666], [0.1630212366580963],
              [0.07249991595745087], [0.09454856812953949], [0.18981967866420746], [0.5550419688224792]],
             [[0.47141966223716736], [0.04179742559790611], [0.12573236227035522], [0.1564657986164093],
              [0.012741370126605034], [0.14815577864646912], [0.18183854222297668], [0.48780354857444763]],
             [[0.47000834345817566], [0.06170516088604927], [0.17182296514511108], [0.10907932370901108],
              [0.09755145013332367], [0.23061582446098328], [0.2225673943758011], [0.4233081042766571]],
             [[0.4948790669441223], [0.45086702704429626], [0.5180673003196716], [0.5856656432151794],
              [0.6092485189437866], [0.5557336807250977], [0.4533920884132385], [0.4013553559780121]]]
        ]

        layer = Sobel(1e-4)
        result = layer(tf.convert_to_tensor(source))
        self.assertAllClose(expected, result)

    def test_values_3(self):
        source = [
            [[[0.7065600420651565, 0.013655455261084137, 0.4136658723334379],
              [0.5728353369950823, 0.2647608039844954, 0.3661055069786796],
              [0.3671539772026423, 0.08946119151900045, 0.9339879556564498],
              [0.23045230622613255, 0.5272269856862665, 0.911200452008624],
              [0.48687485711361567, 0.04279201117822096, 0.05765432434275963],
              [0.7045069593211779, 0.34690705147792344, 0.20341164943854573],
              [0.9557513383533766, 0.5222893737523994, 0.2722319375844424],
              [0.5253473437365669, 0.013552627715530785, 0.36725117008083097]],
             [[0.6883468814542377, 0.9630344329830665, 0.9521145985375987],
              [0.12547801348576437, 0.04703161037300474, 0.8494414182897948],
              [0.7321643123379413, 0.4975110855981534, 0.8584070298669054],
              [0.5018175326326773, 0.36273964977113105, 0.3557832723058486],
              [0.22356624370421863, 0.04921210288070099, 0.39897947286820257],
              [0.7124355127299796, 0.35900990947539746, 0.3530245857483243],
              [0.9252414599604687, 0.2860496215785411, 0.15624902533196194],
              [0.675790012621702, 0.7812015771303968, 0.2851558221282554]],
             [[0.8312209718359039, 0.9264281734015194, 0.291107764631346],
              [0.014228480613127203, 0.34661033900162264, 0.754684482282129],
              [0.5076631232321712, 0.7297454318575931, 0.1009366029562091],
              [0.8110810896436547, 0.3041906744855777, 0.8407458705707094],
              [0.7158823794394479, 0.6077238015866411, 0.5852864463171471],
              [0.7203929394805371, 0.4274921967419205, 0.03392839779445456],
              [0.5995205708996918, 0.3789212566485324, 0.6788057134953379],
              [0.5822911143382207, 0.7393212243380353, 0.6221142083611966]],
             [[0.8803626359555328, 0.1850943241012607, 0.6485418995875553],
              [0.9853043345690564, 0.4625352979555043, 0.9298725045451146],
              [0.2862534726656676, 0.6047859102322192, 0.9899775364367694],
              [0.15432557907363864, 0.42086881485008965, 0.13596063848778828],
              [0.8880426514172315, 0.8937678958260148, 0.7074544356282754],
              [0.6918404313790653, 0.6361926982104839, 0.5821745978463295],
              [0.9298541467153439, 0.5173480742584735, 0.18745711676556076],
              [0.36704991050970626, 0.21604885396271933, 0.5130857998312982]],
             [[0.19808010809944654, 0.7155036857678547, 0.17232921110337251],
              [0.24676933325565198, 0.3458760060551406, 0.6587430366426895],
              [0.6944442109045204, 0.24039297011521654, 0.5141679228864651],
              [0.2542007974494803, 0.8160143922327467, 0.4996370972134867],
              [0.7863498257461765, 0.9289878395580063, 0.3456912931848929],
              [0.7526668260231728, 0.15762575784260136, 0.5961107858000652],
              [0.02775740134675797, 0.585602436336178, 0.6320381035966078],
              [0.9364329862295956, 0.5949840533845474, 0.6793634995159071]],
             [[0.7500513367259428, 0.7350687419245497, 0.02526254200445044],
              [0.03529158663461951, 0.8221871414471598, 0.8269887581140981],
              [0.583204031971486, 0.7413168903740461, 0.3709817610985794],
              [0.39559472507865334, 0.17502746018636206, 0.03533864057895231],
              [0.09998517069607826, 0.3123527402919537, 0.4344842509003648],
              [0.9413738049463155, 0.5862325221731051, 0.10762266070799409],
              [0.9666328564754963, 0.842345592101174, 0.8195585220618494],
              [0.00481777180317966, 0.10391593176576186, 0.5923234624681379]],
             [[0.7869130482995423, 0.5937386623535441, 0.14389522467529803],
              [0.6701955044680679, 0.4457327368020477, 0.9237385526014019],
              [0.9492306779353914, 0.6650996604727649, 0.6948298424048523],
              [0.6663076107897893, 0.33518758486594136, 0.3079469934463218],
              [0.26871132062338954, 0.9768801137989317, 0.6968262570601934],
              [0.9706485485164944, 0.018281823358380134, 0.5454837143198893],
              [0.3584286828903783, 0.6935839904310835, 0.06507532181530307],
              [0.027386690582597017, 0.47631948392635703, 0.856674009140016]],
             [[0.9693874347966286, 0.1419258125441103, 0.8908512396328458],
              [0.46708469811966435, 0.9712865502325881, 0.38556981854203676],
              [0.16671714117132386, 0.9175803358283217, 0.7700947464730861],
              [0.5154451105931174, 0.315080321625859, 0.30952254678270563],
              [0.22966460666565325, 0.1254582566709983, 0.9395240782544287],
              [0.37099656587046737, 0.9722959001085545, 0.2145150690589982],
              [0.5961860132126998, 0.8501115387082833, 0.2600112019297852],
              [0.7497121831020023, 0.14139607999930703, 0.6612723596723924]]],
            [[[0.26077574160034045, 0.9501608027318134, 0.04303826089320739],
              [0.5991891789403825, 0.7459068380703668, 0.530691117533507],
              [0.0007778093220706106, 0.947220294401151, 0.9816443166681721],
              [0.1332745368431436, 0.3081603795461614, 0.545365052642437],
              [0.9833823775914661, 0.6513956832541683, 0.435012731307725],
              [0.28425276442294767, 0.9417767615398354, 0.5605254857208194],
              [0.049538587830162184, 0.07989399036487344, 0.6760824132961585],
              [0.5469493787606243, 0.44739035123977255, 0.011723235346708938]],
             [[0.8355976738022487, 0.40138709041168463, 0.3000825067741342],
              [0.6287972818397564, 0.7601107990286872, 0.239671066195693],
              [0.48132770595801766, 0.051432846371347374, 0.023518837228678202],
              [0.1874210102775279, 0.08719220534161543, 0.5559095105743986],
              [0.9659901410106244, 0.28819128597286914, 0.6773369084658828],
              [0.30686133721547393, 0.8586219400982509, 0.6795468825233034],
              [0.3838131286621147, 0.015414116810642198, 0.426355072931633],
              [0.671851933917698, 0.6505219638296745, 0.08058437999546109]],
             [[0.4180515839579897, 0.47985181851423064, 0.386247803681941],
              [0.11260797373082987, 0.2253855088678478, 0.8283378985243222],
              [0.2097707367132553, 0.05008036936120053, 0.9080040715487095],
              [0.015424879670303593, 0.1788517348628762, 0.14084402566256415],
              [0.8623803239588064, 0.1589926467656766, 0.514288353026167],
              [0.3816764145031347, 0.7508191555599367, 0.10790979860972738],
              [0.801718971399359, 0.900238191911562, 0.014940131998221862],
              [0.3101763334450891, 0.3856366310555617, 0.6556539282495488]],
             [[0.6292201734423072, 0.41423314334742956, 0.2693222632426818],
              [0.6180837761057622, 0.5578712905333086, 0.17812926433116183],
              [0.3313050876728827, 0.1032419633172812, 0.8384278262918622],
              [0.7286975681586241, 0.7925258206689049, 0.2662374190899498],
              [0.5495990719105777, 0.44390127649134414, 0.6555506090050539],
              [0.8833817745438194, 0.8401130144980214, 0.006767454639187265],
              [0.6016313116842291, 0.8984796397777878, 0.6071159367893193],
              [0.5973155630768282, 0.4881412582407939, 0.29138914629027346]],
             [[0.06749004665300218, 0.2901907264396598, 0.4867991305900009],
              [0.012194437345338316, 0.8722797391873078, 0.6232812763954803],
              [0.8271611983679027, 0.4500982266185821, 0.12164938094916056],
              [0.555624911659924, 0.8613157168790232, 0.8711743587080171],
              [0.3375656148902091, 0.8012194318203923, 0.694832442992459],
              [0.08225795145678472, 0.45201094834397704, 0.42141533721897273],
              [0.6691499437249505, 0.33110071409937236, 0.26042471668337774],
              [0.22679771852473796, 0.16958157524936224, 0.5887520029841616]],
             [[0.7275527001018619, 0.8785469481850189, 0.9031916035902204],
              [0.8641958373490839, 0.46584574540721213, 0.9386223005522568],
              [0.5975793698495208, 0.7709380541778461, 0.6043209867093434],
              [0.8238450231610133, 0.8640773528485957, 0.9030353828910842],
              [0.14664348837007724, 0.5756396794319861, 0.2308546248390272],
              [0.8964336766915286, 0.6922449745621466, 0.31742863978385505],
              [0.753037091835451, 0.7051820227176319, 0.2529141668344228],
              [0.7493776337539161, 0.2586423287994687, 0.14451566683888128]],
             [[0.256970874418454, 0.6014022879287202, 0.2890266494613528],
              [0.7755475107986411, 0.8527497007826443, 0.7937808407283328],
              [0.5619259479630659, 0.8225100111976311, 0.13006419850245154],
              [0.9184856174531121, 0.08172037136980204, 0.835624116788227],
              [0.83146525777777, 0.07859234182144015, 0.6214176902481836],
              [0.06561175151388399, 0.7021297438330697, 0.7342018477140411],
              [0.03526761368452169, 0.35866922634291953, 0.18936596346679646],
              [0.3124373495974878, 0.40424958339455064, 0.856686468518249]],
             [[0.6494463177770567, 0.6590248758479201, 0.3227355224684143],
              [0.7452795092152058, 0.7672121925146023, 0.2650614949894874],
              [0.10026918915050431, 0.5902109267498771, 0.4898201291459443],
              [0.03505057225808461, 0.6191462157551978, 0.12609485947345223],
              [0.9777826943359275, 0.2988797881984536, 0.7940088503156995],
              [0.24874554124925452, 0.8209254831363376, 0.8724674437631377],
              [0.6410556738722177, 0.4793231903662253, 0.9232312313055393],
              [0.03572064684842213, 0.9929858764847436, 0.5234784227408094]]]
        ]
        expected = [
            [[[0.540154755115509, 0.41589322686195374, 0.6897949576377869],
              [0.486876517534256, 0.41149142384529114, 0.6256396174430847],
              [0.47113847732543945, 0.3757129907608032, 0.6309633255004883],
              [0.5073289275169373, 0.3508538007736206, 0.5954834818840027],
              [0.6013339757919312, 0.3414197266101837, 0.48573973774909973],
              [0.6778723001480103, 0.3668031394481659, 0.34697404503822327],
              [0.7039042711257935, 0.422615647315979, 0.34273573756217957],
              [0.7680216431617737, 0.4486146867275238, 0.35643887519836426]],
             [[0.5274317264556885, 0.44760391116142273, 0.6673511862754822],
              [0.09717336297035217, 0.190434530377388, 0.025739816948771477],
              [0.06280959397554398, 0.18337735533714294, 0.11187586933374405],
              [0.15344563126564026, 0.19076761603355408, 0.25848013162612915],
              [0.2128288596868515, 0.19336006045341492, 0.25892844796180725],
              [0.16675503551959991, 0.18249014019966125, 0.15345804393291473],
              [0.056923843920230865, 0.15453796088695526, 0.140462264418602],
              [0.7180477976799011, 0.4362902045249939, 0.34174713492393494]],
             [[0.536388099193573, 0.5019125938415527, 0.6487261652946472],
              [0.10365624725818634, 0.10449710488319397, 0.05461776629090309],
              [0.024455413222312927, 0.14547455310821533, 0.113727867603302],
              [0.16548298299312592, 0.22391954064369202, 0.19470763206481934],
              [0.16620025038719177, 0.2464914172887802, 0.1614786684513092],
              [0.07559142261743546, 0.18931181728839874, 0.1567559391260147],
              [0.08362998813390732, 0.09775317460298538, 0.1745510995388031],
              [0.6843541264533997, 0.4680001139640808, 0.4158472716808319]],
             [[0.529911994934082, 0.521250307559967, 0.6151869297027588],
              [0.11699109524488449, 0.056693900376558304, 0.14157021045684814],
              [0.05759183317422867, 0.08804770559072495, 0.13994622230529785],
              [0.18576224148273468, 0.10861925035715103, 0.17903921008110046],
              [0.16351597011089325, 0.10569196194410324, 0.059408437460660934],
              [0.05687287449836731, 0.11363554745912552, 0.06899049133062363],
              [0.12254656106233597, 0.0659954696893692, 0.14410975575447083],
              [0.6459046006202698, 0.4748609662055969, 0.4914281368255615]],
             [[0.5254336595535278, 0.5490732789039612, 0.5520179271697998],
              [0.06638466566801071, 0.09134913235902786, 0.09198764711618423],
              [0.03589931130409241, 0.05003776773810387, 0.11274005472660065],
              [0.1447163075208664, 0.05047817900776863, 0.17163921892642975],
              [0.16631832718849182, 0.06096070259809494, 0.07149328291416168],
              [0.09201456606388092, 0.07854736596345901, 0.11427158862352371],
              [0.17825163900852203, 0.08620314300060272, 0.0971841961145401],
              [0.6165176630020142, 0.46687647700309753, 0.5247684121131897]],
             [[0.5561690926551819, 0.6012728214263916, 0.523244321346283],
              [0.09302517026662827, 0.12274108827114105, 0.041800521314144135],
              [0.08985964208841324, 0.07177051901817322, 0.0688110888004303],
              [0.07372769713401794, 0.06639555096626282, 0.1434054672718048],
              [0.12811259925365448, 0.08475030958652496, 0.023502852767705917],
              [0.10617469251155853, 0.02665191888809204, 0.1276322603225708],
              [0.17582236230373383, 0.07001140713691711, 0.12105575203895569],
              [0.5749855637550354, 0.4746556878089905, 0.5182319283485413]],
             [[0.625504732131958, 0.6388870477676392, 0.5679327249526978],
              [0.17080388963222504, 0.030719490721821785, 0.1163150891661644],
              [0.15012772381305695, 0.11465223133563995, 0.10818253457546234],
              [0.028339995071291924, 0.13355517387390137, 0.16699793934822083],
              [0.09934006631374359, 0.05649615824222565, 0.11202792078256607],
              [0.08669847249984741, 0.06772059202194214, 0.051197249442338943],
              [0.10390105843544006, 0.07594168186187744, 0.12560656666755676],
              [0.5438078045845032, 0.5046231746673584, 0.48416945338249207]],
             [[0.6646779775619507, 0.6758297681808472, 0.61162269115448],
              [0.5852662324905396, 0.6402698159217834, 0.5415214896202087],
              [0.5241451263427734, 0.5984461903572083, 0.5238854885101318],
              [0.46407631039619446, 0.5231226086616516, 0.485390305519104],
              [0.4895232617855072, 0.49062538146972656, 0.4501333236694336],
              [0.5296048521995544, 0.5381455421447754, 0.44165411591529846],
              [0.5244646072387695, 0.5417798161506653, 0.47887054085731506],
              [0.536797285079956, 0.5529745221138, 0.5086823105812073]]],
            [[[0.47305575013160706, 0.6186507940292358, 0.4289308488368988],
              [0.4199000298976898, 0.5264033079147339, 0.48416629433631897],
              [0.3369407653808594, 0.42943793535232544, 0.5257905125617981],
              [0.4109688401222229, 0.3644804358482361, 0.5160123109817505],
              [0.4778801500797272, 0.4496200978755951, 0.48086532950401306],
              [0.5011016130447388, 0.5153447389602661, 0.44825831055641174],
              [0.46693891286849976, 0.5241870880126953, 0.4091252386569977],
              [0.44303300976753235, 0.5210710763931274, 0.38123178482055664]],
             [[0.43297621607780457, 0.5387317538261414, 0.4393804371356964],
              [0.21028277277946472, 0.32997044920921326, 0.15068620443344116],
              [0.02893875539302826, 0.27768564224243164, 0.09338033944368362],
              [0.17925091087818146, 0.16270962357521057, 0.06956025958061218],
              [0.13605354726314545, 0.21337300539016724, 0.14630429446697235],
              [0.1390267014503479, 0.11017901450395584, 0.19024185836315155],
              [0.1829051375389099, 0.18989922106266022, 0.17360660433769226],
              [0.45389869809150696, 0.5886855721473694, 0.35984230041503906]],
             [[0.4350277781486511, 0.40374600887298584, 0.46993252635002136],
              [0.12607625126838684, 0.1594422161579132, 0.09933285415172577],
              [0.07969827950000763, 0.09962240606546402, 0.06279842555522919],
              [0.17732316255569458, 0.18396613001823425, 0.06698347628116608],
              [0.13679750263690948, 0.29237791895866394, 0.1257530152797699],
              [0.04007946327328682, 0.1307632476091385, 0.11171487718820572],
              [0.09985422343015671, 0.08686447143554688, 0.06081008166074753],
              [0.508266270160675, 0.6095251441001892, 0.3332115709781647]],
             [[0.4279371201992035, 0.4219503402709961, 0.5218727588653564],
              [0.0694708302617073, 0.20909152925014496, 0.15533116459846497],
              [0.15944752097129822, 0.31008970737457275, 0.12834104895591736],
              [0.12778766453266144, 0.35335615277290344, 0.1357034593820572],
              [0.0820142850279808, 0.2861310541629791, 0.17725932598114014],
              [0.03723059222102165, 0.060649119317531586, 0.10249299556016922],
              [0.031903527677059174, 0.10708854347467422, 0.010861793532967567],
              [0.5429732799530029, 0.5887988209724426, 0.32437482476234436]],
             [[0.4924396574497223, 0.5543738603591919, 0.5521196126937866],
              [0.22446243464946747, 0.24487312138080597, 0.09914354979991913],
              [0.22548577189445496, 0.22391243278980255, 0.07082316279411316],
              [0.14615094661712646, 0.1370798796415329, 0.12314675748348236],
              [0.030807727947831154, 0.037584200501441956, 0.21728257834911346],
              [0.08979564160108566, 0.14210465550422668, 0.18447649478912354],
              [0.10273652523756027, 0.19071416556835175, 0.054149702191352844],
              [0.5384927988052368, 0.538260817527771, 0.3476179540157318]],
             [[0.5480116605758667, 0.6538711190223694, 0.5412635803222656],
              [0.14100998640060425, 0.12347911298274994, 0.021199125796556473],
              [0.05484602227807045, 0.06726755201816559, 0.03699704632163048],
              [0.09484878182411194, 0.11610076576471329, 0.029946990311145782],
              [0.11035516858100891, 0.14732305705547333, 0.14476759731769562],
              [0.09706593304872513, 0.11724389344453812, 0.23189960420131683],
              [0.1497688889503479, 0.1154082790017128, 0.18368974328041077],
              [0.48587965965270996, 0.5131221413612366, 0.43883073329925537]],
             [[0.5576501488685608, 0.7030273675918579, 0.5222354531288147],
              [0.01043467503041029, 0.057314712554216385, 0.19678230583667755],
              [0.0866670310497284, 0.19767391681671143, 0.16183796525001526],
              [0.0894458219408989, 0.18922197818756104, 0.1001044288277626],
              [0.0982411727309227, 0.1275443434715271, 0.07776693254709244],
              [0.1664762794971466, 0.062464162707328796, 0.22877122461795807],
              [0.16517043113708496, 0.11804492026567459, 0.2680325508117676],
              [0.39829733967781067, 0.586907684803009, 0.5741825699806213]],
             [[0.6287083029747009, 0.753745973110199, 0.5329923033714294],
              [0.6142480373382568, 0.697038471698761, 0.5509111285209656],
              [0.5869871973991394, 0.6629552245140076, 0.5489405989646912],
              [0.5657250285148621, 0.5687366724014282, 0.5685869455337524],
              [0.5447945594787598, 0.5249561667442322, 0.5794427394866943],
              [0.5276582837104797, 0.5558230876922607, 0.5590636134147644],
              [0.4588313698768616, 0.5675944685935974, 0.5274302363395691],
              [0.38123708963394165, 0.6236123442649841, 0.6052826642990112]]]
        ]

        layer = Sobel(1e-4)
        result = layer(tf.convert_to_tensor(source))
        self.assertAllClose(expected, result)


if __name__ == '__main__':
    tf.test.main()
